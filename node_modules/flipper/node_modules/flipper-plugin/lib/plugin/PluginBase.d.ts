/// <reference types="node" />
import { EventEmitter } from 'events';
import { SandyPluginDefinition } from './SandyPluginDefinition';
import { MenuEntry, NormalizedMenuEntry } from './MenuEntry';
import { FlipperLib } from './FlipperLib';
import { Device, RealFlipperDevice } from './DevicePlugin';
import { Idler } from '../utils/Idler';
import { Notification } from './Notification';
import { Logger } from '../utils/Logger';
declare type StateExportHandler<T = any> = (idler: Idler, onStatusMessage: (msg: string) => void) => Promise<T | undefined | void>;
declare type StateImportHandler<T = any> = (data: T) => void;
export interface BasePluginClient {
    readonly pluginKey: string;
    readonly device: Device;
    onDestroy(cb: () => void): void;
    onActivate(cb: () => void): void;
    onDeactivate(cb: () => void): void;
    onDeepLink(cb: (deepLink: unknown) => void): void;
    onExport<T extends object>(exporter: StateExportHandler<T>): void;
    onImport<T = any>(handler: StateImportHandler<T>): void;
    onReady(handler: () => void): void;
    addMenuEntry(...entry: MenuEntry[]): void;
    createPaste(input: string): Promise<string | undefined>;
    readonly isFB: boolean;
    GK(gkName: string): boolean;
    showNotification(notification: Notification): void;
    writeTextToClipboard(text: string): void;
    logger: Logger;
}
declare let currentPluginInstance: BasePluginInstance | undefined;
export declare function setCurrentPluginInstance(instance: typeof currentPluginInstance): void;
export declare function getCurrentPluginInstance(): typeof currentPluginInstance;
export interface Persistable {
    serialize(): any;
    deserialize(value: any): void;
}
export declare function registerStorageAtom(key: string | undefined, persistable: Persistable): void;
export declare abstract class BasePluginInstance {
    readonly flipperLib: FlipperLib;
    definition: SandyPluginDefinition;
    instanceApi: any;
    readonly device: Device;
    readonly pluginKey: string;
    activated: boolean;
    destroyed: boolean;
    readonly events: EventEmitter;
    initialStates?: Record<string, any>;
    readonly rootStates: Record<string, Persistable>;
    lastDeeplink?: any;
    exportHandler?: StateExportHandler;
    importHandler?: StateImportHandler;
    menuEntries: NormalizedMenuEntry[];
    logListeners: Symbol[];
    constructor(flipperLib: FlipperLib, definition: SandyPluginDefinition, realDevice: RealFlipperDevice, pluginKey: string, initialStates?: Record<string, any>);
    protected initializePlugin(factory: () => any): void;
    protected createBasePluginClient(): BasePluginClient;
    activate(): void;
    deactivate(): void;
    destroy(): void;
    triggerDeepLink(deepLink: unknown): void;
    exportStateSync(): {
        [k: string]: any;
    };
    private serializeRootStates;
    exportState(idler: Idler, onStatusMessage: (msg: string) => void): Promise<Record<string, any>>;
    isPersistable(): boolean;
    protected assertNotDestroyed(): void;
    abstract toJSON(): string;
}
export {};
//# sourceMappingURL=PluginBase.d.ts.map